generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?          // <-- FIX: optional name field present
  role      Role
  createdAt DateTime @default(now())

  doctor    Doctor?
  patient   Patient?
  tokens    RefreshToken[]   // optional back-relation
}

model Doctor {
  id        Int       @id @default(autoincrement())
  userId    Int       @unique
  specialty String

  user        User         @relation(fields: [userId], references: [id])
  appointments Appointment[]
}

model Patient {
  id      Int @id @default(autoincrement())
  userId  Int @unique
  phone   String?

  user        User         @relation(fields: [userId], references: [id])
  appointments Appointment[]
}

model Appointment {
  id        Int      @id @default(autoincrement())
  doctorId  Int
  patientId Int
  date      DateTime
  status    AppointmentStatus @default(PENDING)

  doctor   Doctor  @relation(fields: [doctorId], references: [id])
  patient  Patient @relation(fields: [patientId], references: [id])

  @@index([doctorId])
  @@index([patientId])
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  userId    Int
  revoked   Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId])
}

enum Role {
  ADMIN
  DOCTOR
  PATIENT
}

enum AppointmentStatus {
  PENDING
  APPROVED
  CANCELED
}
